<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta charset="utf-8" />
        <link rel="stylesheet" href="login3.css" />
        <link rel="stylesheet" href="Sguidelogin3.css" />
        <link rel="stylesheet" href="Slogin3.css" />
        <!-- Supabase JS -->
        <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
        <!-- Enhanced Booking System -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script src="supabase-config.js"></script>
        <script src="user-manager.js"></script>
        <script src="booking-manager.js"></script>
        <style>
            /* Booking overlay styles (minimal, non-destructive) */
            .booking-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 9999; }
            .booking-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.5); }
            .booking-modal { position: relative; background: #fff; max-width: 720px; width: 94%; max-height: 90vh; overflow:auto; border-radius: 8px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 2; }
            .booking-modal h2 { margin-top: 0; }
            .booking-close { position: absolute; right: 8px; top: 8px; background: transparent; border: none; font-size: 24px; cursor: pointer; }
            .booking-modal label { display:block; margin:8px 0; font-size:14px; }
            .booking-modal input[type="text"], .booking-modal input[type="time"], .booking-modal input[type="date"] { width:100%; padding:8px; box-sizing: border-box; }
            .booking-modal button[type="submit"] { margin-top: 12px; padding:10px 14px; background:#1976d2; color:#fff; border:none; border-radius:4px; cursor:pointer; }
            .frame-stadium .stadium { cursor: pointer; }
            .payment-section { display: none; margin-top: 20px; text-align: center; border-top: 1px solid #ddd; padding-top: 20px; }
            .payment-section.show { display: block !important; }
            .payment-notice { color: #856404; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 10px; margin: 10px 0; }
            .payment-success { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; padding: 10px; margin: 10px 0; }
            .payment-success { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; padding: 10px; margin: 10px 0; }
            .qr-code { max-width: 300px; margin: 10px auto; }
            .qr-code img { width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px; }
            .slip-upload { margin-top: 15px; }
            .slip-upload input[type="file"] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px; }
            .slip-upload button { margin-top: 10px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
            .slip-upload button:hover { background: #45a049; }
            .slip-upload button:disabled { background: #cccccc; cursor: not-allowed; }
            .cancel-payment-btn { background: #6c757d !important; }
            .cancel-payment-btn:hover { background: #5a6268 !important; }
            .slip-preview { margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9; }
            .slip-preview img { max-width: 200px; border: 1px solid #ddd; border-radius: 4px; }
            .progress-container { margin-top: 10px; }
            .progress-bar-bg { background: #e0e0e0; border-radius: 4px; overflow: hidden; height: 20px; }
            .progress-bar-fill { height: 100%; background: #4caf50; transition: width 0.3s ease; }
            .payment-instructions { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 15px; margin: 15px 0; }
            .payment-instructions h4 { margin-top: 0; color: #856404; }
            .payment-instructions ol { text-align: left; margin: 10px 0; }
            .payment-instructions li { margin: 5px 0; }
            .success-message { background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; text-align: center; }
            .warning-message { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; text-align: center; }
            .error-message { background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; padding: 20px; text-align: center; }
            .booking-form { display: block; }
            .booking-form.hide { display: none !important; }
            /* Time Selector Styles */
            .time-selector { margin: 10px 0; }
            .time-buttons { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin: 8px 0; }
            .time-btn { padding: 8px 12px; border: 2px solid #ddd; background: #fff; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s; text-align: center; }
            .time-btn:hover { background: #f0f0f0; border-color: #1976d2; }
            .time-btn.selected { background: #1976d2; color: white; border-color: #1976d2; }
            .time-btn.disabled { background: #f5f5f5; color: #ccc; cursor: not-allowed; border-color: #eee; }
            .time-btn.disabled:hover { background: #f5f5f5; border-color: #eee; }
            /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß - ‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö */
            .time-btn.unavailable, .time-btn.booked { 
                background: #e0e0e0 !important; 
                color: #999 !important; 
                border-color: #ccc !important; 
                cursor: not-allowed !important;
                opacity: 0.6;
            }
            .time-btn.unavailable:hover, .time-btn.booked:hover { 
                background: #e0e0e0 !important; 
                border-color: #ccc !important; 
                color: #999 !important;
            }
            /* ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏≤‡∏Å‡∏ö‡∏≤‡∏ó - ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß */
            
            /* ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß */
            #timeToSelector {
                display: none;
                opacity: 0;
                max-height: 0;
                overflow: hidden;
                transition: all 0.3s ease-in-out;
            }
            
            #timeToSelector.show {
                display: block;
                opacity: 1;
                max-height: 300px;
            }
            
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ slide down */
            #timeToSelector.show .time-buttons {
                animation: slideDown 0.3s ease-in-out;
            }
            
            @keyframes slideDown {
                from {
                    transform: translateY(-20px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
            
            /* Google Maps Styles */
            .stadium-map-container {
                margin: 15px 0;
                border: 1px solid #ddd;
                border-radius: 8px;
                overflow: hidden;
                background: #f9f9f9;
            }
            
            .map-header {
                background: #1976d2;
                color: white;
                padding: 8px 12px;
                font-size: 14px;
                font-weight: bold;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .map-content {
                height: 200px;
                position: relative;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .map-content:hover {
                filter: brightness(1.1);
                transform: scale(1.02);
            }
            
            .map-content iframe {
                width: 100%;
                height: 100%;
                border: none;
            }
            
            .map-overlay {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1;
            }
            
            .map-click-hint {
                background: rgba(25, 118, 210, 0.9);
                color: white;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 12px;
                opacity: 0;
                transition: opacity 0.3s ease;
                pointer-events: none;
            }
            
            .map-content:hover .map-click-hint {
                opacity: 1;
            }
        </style>
    </head>
    <body>
        <div class="login">
            <div class="group">
                <div class="rectangle"></div>
                <div class="location">
                    <p class="text-wrapper">San Kamphaeng District, Chiang Mai 50130</p>
                    <img class="location-on" src="https://c.animaapp.com/1Cq5Stlb/img/location-on.svg" />
                    <div class="div">(+66)4 202 1262</div>
                    <img class="phone" src="https://c.animaapp.com/1Cq5Stlb/img/phone.svg" />
                    <div class="text-wrapper-2">(+66)5 678 9438</div>
                    <div class="text-wrapper-3">Sadtavut2011@gmail.com</div>
                    <img class="img" src="https://c.animaapp.com/1Cq5Stlb/img/phone.svg" />
                    <img class="mail" src="https://c.animaapp.com/1Cq5Stlb/img/mail.svg" />
                </div>
            </div>
            <div class="rectangle-2"></div>
            <div class="text-wrapper-4">Football</div>
            <img class="ellipse" src="img/logoFB.svg" />
            <div class="w-city">
                <div class="action">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-5">-‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î -</div>
                    <div class="rectangle-4"></div>
                    <div class="group-2">
                        <img class="line" src="img/line-1.svg" /> <img class="line-2" src="img/line-2.svg" />
                    </div>
                </div>
            </div>
            <div class="w-district-CNX">
                <div class="action">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-6">-‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠-</div>
                    <div class="rectangle-4"></div>
                    <div class="group-2">
                        <img class="line" src="img/line-1-2.svg" /> <img class="line-2" src="img/image.svg" />
                    </div>
                </div>
            </div>
            <div class="frame-stadium">
                <div class="stadium">
                    <div class="rectangle-5"></div>
                    <img class="rectangle-6" src="img/stadium1.svg" />
                    <div class="text-wrapper-7">The jaguar Maejo stadium</div>
                    <p class="element">
                        <span class="span">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:¬†526 ‡∏°.5 ‡∏´‡∏ô‡∏≠‡∏á‡∏´‡∏≤‡∏£ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢ ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 50290<br /><br />‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: </span>
                        <span class="text-wrapper-8">‡πÄ‡∏õ‡∏¥‡∏î </span>
                        <span class="span">‡∏õ‡∏¥‡∏î 22:00<br /></span>
                        <span class="span">500 ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á<br /></span>
                        <a
                            href="https://www.google.com/search?client=safari&rls=en&q=%E0%B8%AA%E0%B8%99%E0%B8%B2%E0%B8%A1%E0%B8%9A%E0%B8%AD%E0%B8%A5%E0%B9%81%E0%B8%A1%E0%B9%88%E0%B9%82%E0%B8%88%E0%B9%89&ie=UTF-8&oe=UTF-8&lqi=CifguKrguJnguLLguKHguJrguK3guKXguYHguKHguYjguYLguIjguYlI8_-iwsuugIAIWjwQABABEAIQAxgAGAEYAhgDIirguKrguJnguLLguKEg4Lia4Lit4LilIOC5geC4oeC5iCDguYLguIjguYmSAQxzb2NjZXJfZmllbGSqAW8QASoaIhbguKrguJnguLLguKEg4Lia4Lit4LilKDUyHxABIhutK6wjBL8rY5tJC7RXk2UlR8nssxZy_8VpX7EyLhACIirguKrguJnguLLguKEg4Lia4Lit4LilIOC5geC4oeC5iCDguYLguIjguYk#"
                            target="_blank"
                            rel="noopener noreferrer"
                            ><span class="text-wrapper-9"></span
                        ></a>
                    </p>
                </div>
                <div class="stadium">
                    <div class="rectangle-5"></div>
                    <img class="rectangle-6" src="img/stadium2.svg" />
                    <div class="text-wrapper-10">Maejo Arena</div>
                    <p class="p">
                        <span class="span"
                            >‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:¬†249 ‡∏´‡∏°‡∏π‡πà 5 ‡∏ñ. ‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏¥‡∏Ñ‡∏° 1 ‡∏ï‡∏≥‡∏ö‡∏•‡∏´‡∏ô‡∏≠‡∏á‡∏´‡∏≤‡∏£ <br />‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢ ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 50290<br /><br />‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:
                        </span>
                        <span class="text-wrapper-8">‡πÄ‡∏õ‡∏¥‡∏î </span>
                        <span class="span">‡∏õ‡∏¥‡∏î 22:00<br /></span>
                        <span class="span">800 ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á<br /></span>
                        <a
                            href="https://www.google.com/search?client=safari&rls=en&q=%E0%B8%AA%E0%B8%99%E0%B8%B2%E0%B8%A1%E0%B8%9A%E0%B8%AD%E0%B8%A5%E0%B9%81%E0%B8%A1%E0%B9%88%E0%B9%82%E0%B8%88%E0%B9%89&ie=UTF-8&oe=UTF-8&lqi=CifguKrguJnguLLguKHguJrguK3guKXguYHguKHguYjguYLguIjguYlI8_-iwsuugIAIWjwQABABEAIQAxgAGAEYAhgDIirguKrguJnguLLguKEg4Lia4Lit4LilIOC5geC4oeC5iCDguYLguIjguYmSAQxzb2NjZXJfZmllbGSqAW8QASoaIhbguKrguJnguLLguKEg4Lia4Lit4LilKDUyHxABIhutK6wjBL8rY5tJC7RXk2UlR8nssxZy_8VpX7EyLhACIirguKrguJnguLLguKEg4Lia4Lit4LilIOC5geC4oeC5iCDguYLguIjguYk#"
                            target="_blank"
                            rel="noopener noreferrer"
                            ><span class="text-wrapper-9"></span
                        ></a>
                    </p>
                </div>
                <div class="stadium">
                    <div class="rectangle-5"></div>
                    <img class="rectangle-6" src="img/stadium3.svg" />
                    <div class="text-wrapper-11">‡∏™‡∏ô‡∏≤‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‡∏£‡∏ß‡∏°‡πÇ‡∏ä‡∏Ñ ‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï‡∏Ñ‡∏•‡∏±‡∏ö</div>
                    <p class="element-chiang-mai">
                        <span class="span"
                            >‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:¬†333/99 ‡∏°.7 ‡∏ï.‡∏™‡∏±‡∏ô‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ , Chiang Mai, Thailand<br />, Chiang Mai<br /><br />‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:
                        </span>
                        <span class="text-wrapper-8">‡πÄ‡∏õ‡∏¥‡∏î </span>
                        <span class="span">‡∏õ‡∏¥‡∏î 22:00<br /></span>
                        <span class="span">400 ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á<br /></span>
                        <a
                            href="https://www.google.com/search?client=safari&rls=en&q=%E0%B8%AA%E0%B8%99%E0%B8%B2%E0%B8%A1%E0%B8%9A%E0%B8%AD%E0%B8%A5%E0%B9%81%E0%B8%A1%E0%B9%88%E0%B9%82%E0%B8%88%E0%B9%89&ie=UTF-8&oe=UTF-8&lqi=CifguKrguJnguLLguKHguJrguK3guKXguYHguKHguYjguYLguIjguYlI8_-iwsuugIAIWjwQABABEAIQAxgAGAEYAhgDIirguKrguJnguLLguKEg4Lia4Lit4LilIOC5geC4oeC5iCDguYLguIjguYmSAQxzb2NjZXJfZmllbGSqAW8QASoaIhbguKrguJnguLLguKEg4Lia4Lit4LilKDUyHxABIhutK6wjBL8rY5tJC7RXk2UlR8nssxZy_8VpX7EyLhACIirguKrguJnguLLguKEg4Lia4Lit4LilIOC5geC4oeC5iCDguYLguIjguYk#"
                            target="_blank"
                            rel="noopener noreferrer"
                            ><span class="text-wrapper-9"></span
                        ></a>
                    </p>
                </div>
            </div>
            <a href="login2.html" class="back" style="text-decoration: none; color: inherit;">
                <div class="building-blocks">
                    <div class="content">
                        <div class="state-layer"><img class="icon" src="img/IconBack.svg" /></div>
                    </div>
                </div>
                <div class="text-wrapper-12">‡∏Å‡∏•‡∏±‡∏ö</div>
            </a>
            <div class="menu">
                <div class="rectangle-7"></div>
                <div class="LOGO">
                    <div class="text-wrapper-13">GOAL PARK</div>
                    <img class="vector" src="img/logoGP.svg" />
                </div>
                <a href="Home.html" class="text-wrapper-14">log out</a>
            </div>
        </div>
        <!-- Booking overlay -->
        <div class="booking-overlay" id="bookingOverlay" aria-hidden="true">
            <div class="booking-backdrop" id="bookingBackdrop"></div>
            <div class="booking-modal" role="dialog" aria-modal="true" aria-labelledby="bookingTitle">
                <button class="booking-close" id="bookingClose" aria-label="Close">√ó</button>
                <h2 id="bookingTitle">Booking</h2>
                <div id="bookingInfo"></div>
                <div class="booking-form" id="bookingFormSection">
                    <form id="bookingForm">
                        <label>‡∏™‡∏ô‡∏≤‡∏°: <input type="text" name="stadium" id="stadiumName" readonly></label>
                        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: <input type="text" name="address" id="stadiumAddress" readonly></label>
                        
                        <!-- Google Maps Container -->
                        <div class="stadium-map-container" id="stadiumMapContainer" style="display: none;">
                            <div class="map-header">
                                <span>üìç</span>
                                <span>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡∏ô‡∏≤‡∏° - ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</span>
                            </div>
                            <div class="map-content" id="stadiumMapContent">
                                <iframe id="stadiumMapFrame" 
                                        src="" 
                                        allowfullscreen="" 
                                        loading="lazy" 
                                        referrerpolicy="no-referrer-when-downgrade">
                                </iframe>
                                <div class="map-overlay" id="mapOverlay">
                                    <div class="map-click-hint">üó∫Ô∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Google Maps</div>
                                </div>
                            </div>
                        </div>
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á: <input type="text" name="name" id="bookerName" readonly></label>
                        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: <input type="tel" name="phone" id="bookerPhone" readonly></label>
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <input type="date" name="date" id="bookDate" required></label>
                        <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°:</label>
                        <div class="time-selector" id="timeFromSelector">
                            <div class="time-buttons">
                                <button type="button" class="time-btn" data-time="06:00">06:00</button>
                                <button type="button" class="time-btn" data-time="07:00">07:00</button>
                                <button type="button" class="time-btn" data-time="08:00">08:00</button>
                                <button type="button" class="time-btn" data-time="09:00">09:00</button>
                                <button type="button" class="time-btn" data-time="10:00">10:00</button>
                                <button type="button" class="time-btn" data-time="11:00">11:00</button>
                                <button type="button" class="time-btn" data-time="12:00">12:00</button>
                                <button type="button" class="time-btn" data-time="13:00">13:00</button>
                                <button type="button" class="time-btn" data-time="14:00">14:00</button>
                                <button type="button" class="time-btn" data-time="15:00">15:00</button>
                                <button type="button" class="time-btn" data-time="16:00">16:00</button>
                                <button type="button" class="time-btn" data-time="17:00">17:00</button>
                                <button type="button" class="time-btn" data-time="18:00">18:00</button>
                                <button type="button" class="time-btn" data-time="19:00">19:00</button>
                                <button type="button" class="time-btn" data-time="20:00">20:00</button>
                                <button type="button" class="time-btn" data-time="21:00">21:00</button>
                                <button type="button" class="time-btn" data-time="22:00">22:00</button>
                            </div>
                            <input type="hidden" name="timeFrom" id="timeFrom" required>
                        </div>
                        <label id="timeToLabel" style="display: none;">‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏∂‡∏á:</label>
                        <div class="time-selector" id="timeToSelector">
                            <div class="time-buttons">
                                <button type="button" class="time-btn" data-time="07:00">07:00</button>
                                <button type="button" class="time-btn" data-time="08:00">08:00</button>
                                <button type="button" class="time-btn" data-time="09:00">09:00</button>
                                <button type="button" class="time-btn" data-time="10:00">10:00</button>
                                <button type="button" class="time-btn" data-time="11:00">11:00</button>
                                <button type="button" class="time-btn" data-time="12:00">12:00</button>
                                <button type="button" class="time-btn" data-time="13:00">13:00</button>
                                <button type="button" class="time-btn" data-time="14:00">14:00</button>
                                <button type="button" class="time-btn" data-time="15:00">15:00</button>
                                <button type="button" class="time-btn" data-time="16:00">16:00</button>
                                <button type="button" class="time-btn" data-time="17:00">17:00</button>
                                <button type="button" class="time-btn" data-time="18:00">18:00</button>
                                <button type="button" class="time-btn" data-time="19:00">19:00</button>
                                <button type="button" class="time-btn" data-time="20:00">20:00</button>
                                <button type="button" class="time-btn" data-time="21:00">21:00</button>
                                <button type="button" class="time-btn" data-time="22:00">22:00</button>
                                <button type="button" class="time-btn" data-time="23:00">23:00</button>
                            </div>
                            <input type="hidden" name="timeTo" id="timeTo" required>
                        </div>
                        <div id="conflictWarning" style="display: none; color: #d32f2f; background: #ffebee; padding: 10px; border-radius: 4px; margin: 10px 0;"></div>
                        <div id="bookingPrice" style="display: none; background: #e3f2fd; padding: 10px; border-radius: 4px; margin: 10px 0;">
                            <strong>‡∏£‡∏≤‡∏Ñ‡∏≤: <span id="priceAmount">-</span> ‡∏ö‡∏≤‡∏ó</strong>
                            <br><small>(<span id="hoursCount">-</span> ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á √ó <span id="pricePerHour">500</span> ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</small>
                        </div>
                        <button type="submit" id="submitBookingBtn">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                    </form>
                </div>
                <div class="payment-section" id="paymentSection">
                    <h3>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
                    <div id="paymentDetails" style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin: 10px 0;">
                        <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:</strong></p>
                        <div id="bookingSummary"></div>
                    </div>
                    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
                    <div class="qr-code">
                        <img src="img/QR.png" alt="QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô">
                        <div style="text-align: center; margin-top: 10px;">
                            <p><strong>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢</strong></p>
                            <p>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: 123-4-56789-0</p>
                            <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: Goal Park Co.,Ltd.</p>
                        </div>
                    </div>
                    <div class="payment-instructions" style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 15px; margin: 15px 0;">
                        <h4>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</h4>
                        <ol>
                            <li>‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô</li>
                            <li>‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</li>
                            <li>‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô"</li>
                            <li>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô (‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</li>
                        </ol>
                        <p><strong>‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                    </div>
                    <div class="slip-upload">
                        <label for="slipFile"><strong>‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö):</strong></label>
                        <input type="file" id="slipFile" name="slipFile" accept="*">
                        <p style="font-size: 12px; color: #666; margin: 5px 0;">
                            üìÑ <strong>‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°:</strong> ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20MB)<br>
                            üí° <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ
                        </p>
                        <button type="button" id="uploadSlipBtn" style="background: #28a745; margin-top: 10px;">
                            ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                        <div id="slipPreview" style="display: none; margin-top: 10px;">
                            <p><strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏•‡∏¥‡∏õ:</strong></p>
                            <img id="slipImage" style="max-width: 200px; border: 1px solid #ddd; border-radius: 4px;">
                            <p id="slipFileName" style="font-size: 12px; color: #666;"></p>
                        </div>
                    </div>
                    <div id="uploadProgress" style="display: none; margin-top: 10px;">
                        <div style="background: #e0e0e0; border-radius: 4px; overflow: hidden;">
                            <div id="progressBar" style="background: #4caf50; height: 20px; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <p id="progressText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...</p>
                    </div>
                </div>
            </div>
        </div>

        <script>
            (function () {
                // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                let currentBookingData = null;
                let currentBookingId = null;
                let bookingManager = null;

                // Initialize Supabase and BookingManager
                async function initializeBookingSystem() {
                    try {
                        console.log('=== Initializing booking system ===');
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase
                        if (typeof supabase === 'undefined') {
                            console.warn('Supabase library not loaded, trying to load from window');
                            window.supabase = window.supabase || {};
                        }
                        
                        if (typeof SUPABASE_CONFIG === 'undefined' || !SUPABASE_CONFIG) {
                            console.error('SUPABASE_CONFIG not found');
                            return false;
                        }
                        
                        console.log('‚úÖ Supabase config found:', {
                            url: SUPABASE_CONFIG.url,
                            hasKey: !!SUPABASE_CONFIG.anonKey
                        });
                        
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Supabase client
                        if (typeof supabase !== 'undefined' && supabase.createClient) {
                            const { createClient } = supabase;
                            window.supabaseClient = createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
                            window.supabase = window.supabaseClient; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö fallback
                            console.log('‚úÖ Supabase client created successfully');
                        } else {
                            console.error('‚ùå Supabase createClient not available');
                            return false;
                        }
                        
                        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        try {
                            console.log('Testing database connection...');
                            
                            // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö table profiles
                            const { data: testData, error: testError } = await window.supabaseClient
                                .from('profiles')
                                .select('id')
                                .limit(1);

                            if (testError) {
                                console.warn('‚ö†Ô∏è Profiles table test failed:', testError);
                            } else {
                                console.log('‚úÖ Profiles table connection successful');
                            }

                            // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö table bookings (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ)
                            const { data: bookingTestData, error: bookingTestError } = await window.supabaseClient
                                .from('bookings')
                                .select('*')
                                .limit(5);

                            if (bookingTestError) {
                                console.error('‚ùå Bookings table test failed:', bookingTestError);
                                console.error('This will prevent booking conflict detection from working');
                                
                                // ‡∏•‡∏≠‡∏á‡∏î‡∏π table ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                                console.log('üîç Checking other tables...');
                                
                                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö table stadiums
                                try {
                                    const { data: stadiumsData } = await window.supabaseClient
                                        .from('stadiums')
                                        .select('*')
                                        .limit(3);
                                    console.log('üèüÔ∏è Stadiums table:', stadiumsData);
                                } catch (e) {
                                    console.log('‚ùå Stadiums table not accessible');
                                }
                                
                                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö table profiles
                                try {
                                    const { data: profilesData } = await window.supabaseClient
                                        .from('profiles')
                                        .select('*')
                                        .limit(3);
                                    console.log('üë§ Profiles table:', profilesData);
                                } catch (e) {
                                    console.log('‚ùå Profiles table not accessible');
                                }
                                
                            } else {
                                console.log('‚úÖ Bookings table connection successful');
                                console.log('üìä Sample bookings:', bookingTestData);
                                if (bookingTestData && bookingTestData.length > 0) {
                                    console.log('üìã Booking columns:', Object.keys(bookingTestData[0]));
                                }
                            }

                        } catch (connError) {
                            console.error('‚ùå Database connection test failed:', connError);
                        }

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á BookingManager
                        if (typeof BookingManager !== 'undefined') {
                            try {
                                bookingManager = new BookingManager(window.supabaseClient);
                                console.log('‚úÖ BookingManager initialized successfully');
                            } catch (bmError) {
                                console.error('‚ùå BookingManager initialization failed:', bmError);
                                bookingManager = null;
                            }
                        }

                        return true;
                    } catch (error) {
                        console.error('‚ùå Error initializing booking system:', error);
                        
                        // ‡πÅ‡∏™‡∏î‡∏á error ‡πÅ‡∏ö‡∏ö user-friendly
                        const errorMsg = `‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\n1. ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï\n2. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase\n3. ‡πÑ‡∏ü‡∏•‡πå supabase-config.js`;
                        
                        // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á alert ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                        console.error('Please check console for details');
                        
                        return false;
                    }
                }

                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ initialization ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
                document.addEventListener('DOMContentLoaded', function() {
                    initializeBookingSystem();
                    // Initialize map click handlers
                    initMapClickHandler();
                });

                // map stadium elements to details
                const stadiums = Array.from(document.querySelectorAll('.frame-stadium .stadium'));
                const overlay = document.getElementById('bookingOverlay');
                const backdrop = document.getElementById('bookingBackdrop');
                const closeBtn = document.getElementById('bookingClose');
                const bookingForm = document.getElementById('bookingForm');
                const bookingFormSection = document.getElementById('bookingFormSection');
                const paymentSection = document.getElementById('paymentSection');
                const uploadSlipBtn = document.getElementById('uploadSlipBtn');
                const stadiumName = document.getElementById('stadiumName');
                const stadiumAddress = document.getElementById('stadiumAddress');
                const bookingTitle = document.getElementById('bookingTitle');
                const conflictWarning = document.getElementById('conflictWarning');
                const bookingPrice = document.getElementById('bookingPrice');
                const submitBookingBtn = document.getElementById('submitBookingBtn');

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                console.log('Initial setup - Payment section display:', window.getComputedStyle(paymentSection).display);
                console.log('Initial setup - Form section display:', window.getComputedStyle(bookingFormSection).display);
                
                // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                paymentSection.classList.remove('show');
                paymentSection.style.display = 'none';
                bookingFormSection.classList.remove('hide');
                bookingFormSection.style.display = 'block';

                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏ô‡∏≤‡∏° - ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Supabase ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà
                const stadiumPrices = {
                    'The jaguar Maejo stadium': 500,
                    'Maejo Arena': 800,
                    '‡∏™‡∏ô‡∏≤‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‡∏£‡∏ß‡∏°‡πÇ‡∏ä‡∏Ñ ‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï‡∏Ñ‡∏•‡∏±‡∏ö': 400
                };

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ô‡∏≤‡∏°‡∏à‡∏≤‡∏Å Supabase
                async function loadStadiumPrices() {
                    if (!bookingManager) return;
                    
                    try {
                        const { data, error } = await window.supabaseClient
                            .from('stadiums')
                            .select('name, price_per_hour')
                            .eq('status', 'active');

                        if (!error && data) {
                            data.forEach(stadium => {
                                stadiumPrices[stadium.name] = stadium.price_per_hour;
                            });
                        }
                    } catch (error) {
                        console.error('Error loading stadium prices:', error);
                    }
                }

                function openOverlay(data) {
                    stadiumName.value = data.name || '';
                    stadiumAddress.value = data.address || '';
                    bookingTitle.textContent = 'Booking - ' + (data.name || '');
                    
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏ô‡∏≤‡∏°‡∏à‡∏≤‡∏Å Supabase
                    loadStadiumPrices();
                    
                    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á
                    loadUserData();
                    
                    // Reset ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô time selectors
                    resetTimeSelectors();
                    initTimeSelectors();
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 ‡πÄ‡∏™‡∏°‡∏≠
                    resetBookingToFirstStep();
                    
                    // ‡∏ï‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('bookDate').setAttribute('min', today);
                    
                    overlay.style.display = 'flex';
                    overlay.setAttribute('aria-hidden','false');
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á
                async function loadUserData() {
                    try {
                        let userData = {};
                        
                        // 1. ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Supabase Auth ‡πÅ‡∏•‡∏∞ Users table ‡∏Å‡πà‡∏≠‡∏ô (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
                        if (window.supabaseClient) {
                            const { data: { user } } = await window.supabaseClient.auth.getUser();
                            if (user) {
                                console.log('Found Supabase user:', user.email);
                                
                                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á users
                                const { data: profile, error } = await window.supabaseClient
                                    .from('users')
                                    .select('full_name, phone, email')
                                    .eq('id', user.id)
                                    .single();
                                
                                if (!error && profile) {
                                    console.log('Found user profile:', profile);
                                    userData = {
                                        fullName: profile.full_name,
                                        name: profile.full_name,
                                        phone: profile.phone,
                                        email: profile.email || user.email,
                                        userId: user.id
                                    };
                                } else {
                                    console.log('No profile found, using auth data only');
                                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô users table ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å auth
                                    userData = {
                                        fullName: user.user_metadata?.full_name || user.user_metadata?.name || '',
                                        name: user.user_metadata?.full_name || user.user_metadata?.name || '',
                                        phone: user.user_metadata?.phone || '',
                                        email: user.email,
                                        userId: user.id
                                    };
                                }
                            }
                        }
                        
                        // 2. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Supabase ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å localStorage
                        if (!userData.fullName && !userData.name) {
                            const localData = JSON.parse(localStorage.getItem('currentUser') || '{}');
                            if (localData.fullName || localData.name) {
                                userData = localData;
                                console.log('Using localStorage data:', userData);
                            }
                        }
                        
                        // 3. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô localStorage ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å sessionStorage
                        if (!userData.fullName && !userData.name) {
                            const sessionData = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
                            if (sessionData.fullName || sessionData.name) {
                                userData = sessionData;
                                console.log('Using sessionStorage data:', userData);
                            }
                        }
                        
                        // 4. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                        const userName = userData.fullName || userData.name || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ';
                        const userPhone = userData.phone || '';
                        
                        console.log('Final user data:', { userName, userPhone });
                        
                        document.getElementById('bookerName').value = userName;
                        document.getElementById('bookerPhone').value = userPhone;
                        
                        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                        window.currentUserData = userData;
                        
                    } catch (error) {
                        console.error('Error loading user data:', error);
                        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
                        document.getElementById('bookerName').value = '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ';
                        document.getElementById('bookerPhone').value = '';
                        window.currentUserData = {};
                    }
                }

                function closeOverlay() {
                    overlay.style.display = 'none';
                    overlay.setAttribute('aria-hidden','true');
                    // Reset sections to initial state
                    bookingFormSection.classList.remove('hide');
                    paymentSection.classList.remove('show');
                    conflictWarning.style.display = 'none';
                    bookingPrice.style.display = 'none';
                    bookingForm.reset();
                    resetTimeSelectors(); // Reset time selectors
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 ‡πÄ‡∏™‡∏°‡∏≠
                    resetBookingToFirstStep();
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î)
                    resetPaymentForm();
                    
                    currentBookingData = null;
                    currentBookingId = null;
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤
                function calculatePrice() {
                    const stadium = stadiumName.value;
                    const timeFrom = document.getElementById('timeFrom').value;
                    const timeTo = document.getElementById('timeTo').value;
                    
                    if (!stadium || !timeFrom || !timeTo) {
                        bookingPrice.style.display = 'none';
                        return;
                    }

                    const pricePerHour = stadiumPrices[stadium] || 500;
                    let hours = 0;
                    
                    // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å BookingManager ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏≠‡∏á
                    if (bookingManager) {
                        hours = bookingManager.calculateHours(timeFrom, timeTo);
                    } else {
                        // Fallback calculation
                        const [fromHour, fromMin] = timeFrom.split(':').map(Number);
                        const [toHour, toMin] = timeTo.split(':').map(Number);
                        const fromMinutes = fromHour * 60 + fromMin;
                        const toMinutes = toHour * 60 + toMin;
                        hours = (toMinutes - fromMinutes) / 60;
                    }
                    
                    const totalPrice = hours * pricePerHour;

                    document.getElementById('pricePerHour').textContent = pricePerHour;
                    document.getElementById('hoursCount').textContent = hours;
                    document.getElementById('priceAmount').textContent = totalPrice.toLocaleString();
                    bookingPrice.style.display = 'block';
                }

                // ===================================================================
                // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤
                // ===================================================================

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                async function getExistingBookings(stadium, date) {
                    try {
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase client ‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á
                        let client = window.supabaseClient || window.supabase || supabaseClient;
                        
                        if (!client) {
                            console.error('‚ùå No Supabase client available');
                            console.log('Available clients:', {
                                'window.supabaseClient': !!window.supabaseClient,
                                'window.supabase': !!window.supabase,
                                'supabaseClient': typeof supabaseClient !== 'undefined' ? !!supabaseClient : false
                            });
                            return [];
                        }

                        console.log('üîç Checking existing bookings for:');
                        console.log('Stadium:', stadium);
                        console.log('Date:', date);
                        console.log('Using client:', !!client);

                        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô
                        try {
                            const { data: testConnection, error: testError } = await client
                                .from('bookings')
                                .select('count')
                                .limit(1);
                            
                            if (testError) {
                                console.error('‚ùå Connection test failed:', testError);
                                return [];
                            }
                            console.log('‚úÖ Connection test successful');
                        } catch (connError) {
                            console.error('‚ùå Connection error:', connError);
                            return [];
                        }

                        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á
                        console.log('üìã Fetching all bookings to debug...');
                        
                        // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô check_booking_conflict ‡πÅ‡∏ó‡∏ô
                        try {
                            console.log('üîß Trying RPC function for conflict checking...');
                            const { data: conflictData, error: conflictError } = await client
                                .rpc('check_public_booking_conflicts', {
                                    p_stadium_name: stadium,
                                    p_booking_date: date
                                });
                                
                            if (!conflictError && conflictData) {
                                console.log('‚úÖ Found bookings via RPC function:', conflictData);
                                return conflictData.filter(booking => 
                                    ['pending', 'approved', 'confirmed', 'pending_payment'].includes(booking.status)
                                );
                            } else if (conflictError) {
                                console.log('‚ö†Ô∏è RPC function error:', conflictError);
                            }
                        } catch (rpcError) {
                            console.log('‚ö†Ô∏è RPC function not available:', rpcError);
                        }
                        
                        // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ public view
                        try {
                            console.log('üîß Trying public view for conflict checking...');
                            const { data: viewData, error: viewError } = await client
                                .from('public_booking_conflicts')
                                .select('*')
                                .eq('stadium_name', stadium)
                                .eq('booking_date', date);
                                
                            if (!viewError && viewData) {
                                console.log('‚úÖ Found bookings via public view:', viewData);
                                return viewData;
                            } else if (viewError) {
                                console.log('‚ö†Ô∏è Public view error:', viewError);
                            }
                        } catch (viewError) {
                            console.log('‚ö†Ô∏è Public view not available:', viewError);
                        }
                        
                        const { data: allBookings, error: allError } = await client
                            .from('bookings')
                            .select('*');
                            
                        if (allError) {
                            console.error('‚ùå Error fetching all bookings:', allError);
                            
                            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô RLS error ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏∑‡πà‡∏ô
                            if (allError.message && allError.message.includes('policy')) {
                                console.log('üîí RLS is blocking access, trying alternative approach...');
                                
                                // ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô service role ‡∏´‡∏£‡∏∑‡∏≠ public view
                                try {
                                    // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ .select() ‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ fields ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                                    const { data: publicBookings, error: publicError } = await client
                                        .from('bookings')
                                        .select('stadium_name, booking_date, start_time, end_time, status, booker_name')
                                        .eq('stadium_name', stadium)
                                        .eq('booking_date', date);
                                        
                                    if (!publicError && publicBookings) {
                                        console.log('‚úÖ Found bookings via specific query:', publicBookings);
                                        return publicBookings.filter(booking => 
                                            ['pending', 'approved', 'confirmed', 'pending_payment'].includes(booking.status)
                                        );
                                    }
                                } catch (altError) {
                                    console.error('‚ùå Alternative approach failed:', altError);
                                }
                            }
                            return [];
                        }

                        console.log('ÔøΩ Total bookings in database:', allBookings?.length || 0);
                        if (allBookings && allBookings.length > 0) {
                            console.log('üóÇÔ∏è All booking records:', allBookings);
                            
                            // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ô‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            const uniqueStadiums = [...new Set(allBookings.map(b => b.stadium_name))];
                            console.log('üèüÔ∏è Unique stadium names in database:', uniqueStadiums);
                            
                            // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            const uniqueDates = [...new Set(allBookings.map(b => b.booking_date))];
                            console.log('ÔøΩ Unique dates in database:', uniqueDates);
                            
                            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                            const matchingBookings = allBookings.filter(booking => {
                                const stadiumMatch = booking.stadium_name === stadium;
                                const dateMatch = booking.booking_date === date;
                                const statusMatch = ['pending', 'approved', 'confirmed'].includes(booking.status);
                                
                                console.log(`üîç Checking booking:`, {
                                    stadiumName: booking.stadium_name,
                                    stadiumMatch,
                                    bookingDate: booking.booking_date,
                                    dateMatch,
                                    status: booking.status,
                                    statusMatch,
                                    overall: stadiumMatch && dateMatch && statusMatch
                                });
                                
                                return stadiumMatch && dateMatch && statusMatch;
                            });
                            
                            if (matchingBookings.length > 0) {
                                console.log('‚úÖ Found matching bookings via filtering:', matchingBookings);
                                return matchingBookings;
                            } else {
                                console.log('‚ùå No matching bookings found via filtering');
                            }
                        }

                        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        console.log('‚ö†Ô∏è No bookings found in database - table is empty');
                        return [];
                    } catch (error) {
                        console.error('Error in getExistingBookings:', error);
                        return [];
                    }
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                function isTimeOverlapping(start1, end1, start2, end2) {
                    // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ
                    const timeToMinutes = (timeStr) => {
                        const [hour, min] = timeStr.split(':').map(Number);
                        return hour * 60 + min;
                    };

                    const s1 = timeToMinutes(start1);
                    const e1 = timeToMinutes(end1);
                    const s2 = timeToMinutes(start2);
                    const e2 = timeToMinutes(end2);

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
                    return s1 < e2 && s2 < e1;
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ
                function generateAllTimeSlots() {
                    const slots = [];
                    const times = [
                        '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00', 
                        '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', 
                        '20:00', '21:00', '22:00'
                    ];
                    
                    for (let i = 0; i < times.length; i++) {
                        for (let j = i + 1; j < times.length; j++) {
                            slots.push({
                                start: times[i],
                                end: times[j]
                            });
                        }
                    }
                    
                    return slots;
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤
                async function checkAndDisableBookedTimes() {
                    const stadium = stadiumName.value;
                    const dateInput = document.getElementById('bookDate').value;

                    console.log('üîÑ Checking booked times for:', stadium, dateInput);

                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô
                    document.querySelectorAll('.time-btn').forEach(btn => {
                        btn.classList.remove('booked', 'unavailable');
                        btn.disabled = false;
                        btn.title = '';
                        btn.style.pointerEvents = 'auto';
                    });

                    if (!stadium || !dateInput) {
                        console.log('‚ö†Ô∏è No stadium or date selected, stadium:', stadium, 'date:', dateInput);
                        return;
                    }

                    // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    let formattedDate = dateInput;
                    if (dateInput) {
                        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD ‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ
                        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô DD/MM/YYYY ‡πÉ‡∏´‡πâ‡πÅ‡∏õ‡∏•‡∏á
                        if (dateInput.includes('/')) {
                            const [day, month, year] = dateInput.split('/');
                            formattedDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                        }
                    }

                    console.log('üìÖ Original date:', dateInput, '‚Üí Formatted date:', formattedDate);

                    try {
                        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                        const existingBookings = await getExistingBookings(stadium, formattedDate);
                        
                        if (existingBookings.length === 0) {
                            console.log('‚úÖ No existing bookings found for', stadium, 'on', formattedDate);
                            return;
                        }

                        console.log('üìã Found existing bookings:', existingBookings);

                        // ‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ (‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤)
                        const allTimes = [
                            '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00', 
                            '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', 
                            '20:00', '21:00', '22:00'
                        ];
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                        allTimes.forEach(time => {
                            const btn = document.querySelector(`[data-time="${time}"]`);
                            if (!btn) return;

                            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                            const wouldCauseConflict = existingBookings.some(booking => {
                                // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (‡∏ï‡∏±‡∏î :00 ‡∏≠‡∏≠‡∏Å)
                                const normalizeTime = (timeStr) => {
                                    if (timeStr.includes(':00:00')) {
                                        return timeStr.substring(0, 5); // ‡πÄ‡∏≠‡∏≤ HH:MM
                                    }
                                    return timeStr;
                                };

                                const timeMinutes = timeToMinutes(time);
                                const bookingStart = timeToMinutes(normalizeTime(booking.start_time));
                                const bookingEnd = timeToMinutes(normalizeTime(booking.end_time));
                                
                                // Debug log
                                console.log(`Checking time ${time} (${timeMinutes}min) against booking ${normalizeTime(booking.start_time)}-${normalizeTime(booking.end_time)} (${bookingStart}-${bookingEnd}min)`);
                                
                                // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° end time ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ)
                                const isInConflict = timeMinutes >= bookingStart && timeMinutes < bookingEnd;
                                if (isInConflict) {
                                    console.log(`‚ùå Time ${time} conflicts with booking ${booking.booker_name}: ${normalizeTime(booking.start_time)}-${normalizeTime(booking.end_time)}`);
                                }
                                return isInConflict;
                            });

                            if (wouldCauseConflict) {
                                btn.classList.add('unavailable', 'booked');
                                btn.disabled = true;
                                btn.style.pointerEvents = 'none';
                                btn.title = `‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß`;
                                console.log(`üö´ Disabled time: ${time} (conflicts with existing booking)`);
                            } else {
                                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
                                btn.classList.remove('unavailable', 'booked');
                                btn.disabled = false;
                                btn.style.pointerEvents = 'auto';
                                btn.title = '';
                            }
                        });

                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                        console.log('üìã Existing bookings summary:');
                        existingBookings.forEach((booking, index) => {
                            console.log(`${index + 1}. ${booking.booker_name}: ${booking.start_time}-${booking.end_time} (${booking.status})`);
                        });

                        // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
                        const bookingInfo = document.getElementById('bookingInfo');
                        if (bookingInfo) {
                            bookingInfo.style.display = 'none';
                        }

                    } catch (error) {
                        console.error('Error in checkAndDisableBookedTimes:', error);
                    }
                }

                // Helper function: ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ
                function timeToMinutes(timeStr) {
                    const [hour, min] = timeStr.split(':').map(Number);
                    return hour * 60 + min;
                }

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                function createBookingInfoElement() {
                    const existing = document.getElementById('bookingInfo');
                    if (existing) return existing;

                    const element = document.createElement('div');
                    element.id = 'bookingInfo';
                    element.style.display = 'none';
                    
                    const timeSelector = document.querySelector('.time-selector');
                    if (timeSelector && timeSelector.parentNode) {
                        timeSelector.parentNode.insertBefore(element, timeSelector);
                    }
                    
                    return element;
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡πÅ‡∏ö‡∏ö real-time (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà)
                async function checkConflicts() {
                    const stadium = stadiumName.value;
                    const date = document.getElementById('bookDate').value;
                    const timeFrom = document.getElementById('timeFrom').value;
                    const timeTo = document.getElementById('timeTo').value;

                    if (!stadium || !date || !timeFrom || !timeTo) {
                        conflictWarning.style.display = 'none';
                        submitBookingBtn.disabled = false;
                        submitBookingBtn.textContent = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
                        return;
                    }

                    try {
                        console.log('üîç Checking conflicts for:', { stadium, date, timeFrom, timeTo });
                        
                        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                        const existingBookings = await getExistingBookings(stadium, date);
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
                        const conflicts = existingBookings.filter(booking => 
                            isTimeOverlapping(timeFrom, timeTo, booking.start_time, booking.end_time)
                        );
                        
                        if (conflicts.length > 0) {
                            let warningText = `‚ö†Ô∏è ‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥ ${conflicts.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:\n`;
                            conflicts.forEach((conflict, index) => {
                                warningText += `${index + 1}. ${conflict.booker_name} (${conflict.start_time}-${conflict.end_time})\n`;
                            });
                            conflictWarning.textContent = warningText;
                            conflictWarning.style.display = 'block';
                            submitBookingBtn.textContent = '‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥ - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ';
                            submitBookingBtn.disabled = true;
                            
                            console.log('‚ùå Booking conflicts found:', conflicts);
                        } else {
                            conflictWarning.style.display = 'none';
                            submitBookingBtn.textContent = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
                            submitBookingBtn.disabled = false;
                            
                            console.log('‚úÖ No conflicts found');
                        }
                    } catch (error) {
                        console.error('Error checking conflicts:', error);
                        conflictWarning.textContent = '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
                        conflictWarning.style.display = 'block';
                    }
                }

                stadiums.forEach(stad => {
                    stad.addEventListener('click', function () {
                        // try to read existing name/address in DOM
                        const name = (this.querySelector('.text-wrapper-7') || this.querySelector('.text-wrapper-10') || this.querySelector('.text-wrapper-11'))?.textContent?.trim() || '';
                        const addressElement = this.querySelector('.element') || this.querySelector('.p') || this.querySelector('.element-chiang-mai');
                        let address = '';
                        if (addressElement) {
                            // Extract address from the text content, removing status and other info
                            const fullText = addressElement.textContent || '';
                            const addressMatch = fullText.match(/‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:\s*([^]*?)(?:\s*‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:|$)/);
                            address = addressMatch ? addressMatch[1].trim() : '';
                        }
                        openOverlay({ name, address });
                    });
                });

                // Time selector functionality
                function initTimeSelectors() {
                    const timeFromBtns = document.querySelectorAll('#timeFromSelector .time-btn');
                    const timeToBtns = document.querySelectorAll('#timeToSelector .time-btn');
                    const timeFromInput = document.getElementById('timeFrom');
                    const timeToInput = document.getElementById('timeTo');

                    // Handle time from selection
                    timeFromBtns.forEach(btn => {
                        btn.addEventListener('click', function() {
                            if (this.classList.contains('disabled') || this.classList.contains('unavailable')) return;
                            
                            // Remove previous selections
                            timeFromBtns.forEach(b => b.classList.remove('selected'));
                            // Add selection to clicked button
                            this.classList.add('selected');
                            // Set hidden input value
                            timeFromInput.value = this.dataset.time;
                            
                            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
                            showTimeToSelector();
                            
                            // Update time to options
                            updateTimeToOptions(this.dataset.time);
                            
                            // Trigger calculations and checks
                            calculatePrice();
                            checkConflicts();
                            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏° time to ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ
                            setTimeout(() => checkAndDisableBookedTimes(), 100);
                        });
                    });

                    // Handle time to selection
                    timeToBtns.forEach(btn => {
                        btn.addEventListener('click', function() {
                            if (this.classList.contains('disabled') || this.classList.contains('unavailable')) return;
                            
                            // Remove previous selections
                            timeToBtns.forEach(b => b.classList.remove('selected'));
                            // Add selection to clicked button
                            this.classList.add('selected');
                            // Set hidden input value
                            timeToInput.value = this.dataset.time;
                            
                            // Trigger calculations and checks
                            calculatePrice();
                            checkConflicts();
                        });
                    });
                }

                // Update available time to options based on time from
                function updateTimeToOptions(timeFrom) {
                    const timeToBtns = document.querySelectorAll('#timeToSelector .time-btn');
                    const timeToInput = document.getElementById('timeTo');
                    
                    // Clear previous selection
                    timeToBtns.forEach(btn => {
                        btn.classList.remove('selected', 'disabled');
                    });
                    timeToInput.value = '';

                    if (!timeFrom) return;

                    // Parse selected start time
                    const [startHour] = timeFrom.split(':').map(Number);

                    // Disable invalid time to options
                    timeToBtns.forEach(btn => {
                        const [endHour] = btn.dataset.time.split(':').map(Number);
                        if (endHour <= startHour) {
                            btn.classList.add('disabled');
                        }
                    });
                }

                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
                function showTimeToSelector() {
                    const timeToSelector = document.getElementById('timeToSelector');
                    const timeToLabel = document.getElementById('timeToLabel');
                    
                    if (timeToSelector && timeToLabel) {
                        timeToLabel.style.display = 'block';
                        timeToSelector.classList.add('show');
                        
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á
                        setTimeout(() => {
                            timeToSelector.style.display = 'block';
                        }, 50);
                    }
                }

                // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏∂‡∏á
                function hideTimeToSelector() {
                    const timeToSelector = document.getElementById('timeToSelector');
                    const timeToLabel = document.getElementById('timeToLabel');
                    
                    if (timeToSelector && timeToLabel) {
                        timeToLabel.style.display = 'none';
                        timeToSelector.classList.remove('show');
                        
                        setTimeout(() => {
                            timeToSelector.style.display = 'none';
                        }, 300);
                    }
                }

                // ===================================================================
                // Google Maps Functions
                // ===================================================================
                
                // Stadium location data with Google Maps information
                const stadiumMapsData = {
                    'The jaguar Maejo stadium': {
                        name: 'The jaguar Maejo stadium',
                        coords: '18.8896605,99.0143101',
                        embedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3825.4524759658844!2d99.01212139999999!3d18.8896605!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30da239f19925835%3A0x73e5c0459b940e54!2sThe%20jaguar%20Maejo%20stadium!5e0!3m2!1sen!2sth!4v1635000000000!5m2!1sen!2sth',
                        mapsUrl: 'https://www.google.com/maps/place/The+jaguar+Maejo+stadium/@18.8896605,99.0143101,17z/data=!3m1!4b1!4m6!3m5!1s0x30da239f19925835:0x73e5c0459b940e54!8m2!3d18.8896605!4d99.0143101!16s%2Fg%2F11glx4kh_m?entry=ttu&g_ep=EgoyMDI1MTAxNC4wIKXMDSoASAFQAw%3D%3D'
                    },
                    'Maejo Arena': {
                        name: 'Maejo Arena',
                        coords: '18.8790325,99.0119359',
                        embedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3825.784226636842!2d99.00974719999999!3d18.8790325!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30da23c471a5d193%3A0x7730ab03936b22d8!2sMaejo%20Arena!5e0!3m2!1sen!2sth!4v1635000000001!5m2!1sen!2sth',
                        mapsUrl: 'https://www.google.com/maps/place/Maejo+Arena/@18.8790325,99.0119359,17z/data=!3m1!4b1!4m6!3m5!1s0x30da23c471a5d193:0x7730ab03936b22d8!8m2!3d18.8790325!4d99.0119359!16s%2Fg%2F11xmqhdv37?entry=ttu&g_ep=EgoyMDI1MTAxNC4wIKXMDSoASAFQAw%3D%3D'
                    },
                    '‡∏™‡∏ô‡∏≤‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‡∏£‡∏ß‡∏°‡πÇ‡∏ä‡∏Ñ ‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï‡∏Ñ‡∏•‡∏±‡∏ö': {
                        name: '‡∏™‡∏ô‡∏≤‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‡∏£‡∏ß‡∏°‡πÇ‡∏ä‡∏Ñ ‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï‡∏Ñ‡∏•‡∏±‡∏ö',
                        coords: '18.8349329,99.0010251',
                        embedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3826.415863749532!2d98.99883639999999!3d18.8349329!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30da3b002cccdbd3%3A0xf9fc66e598fd6a01!2z4Lij4Lin4Lih4LmC4LiK4LiE4Liq4Lib4Lit4Lij4LmM4LiV4LiE4Lil4Lix4Lia!5e0!3m2!1sen!2sth!4v1635000000002!5m2!1sen!2sth',
                        mapsUrl: 'https://www.google.com/maps/place/%E0%B8%A3%E0%B8%A7%E0%B8%A1%E0%B9%82%E0%B8%8A%E0%B8%84%E0%B8%AA%E0%B8%9B%E0%B8%AD%E0%B8%A3%E0%B9%8C%E0%B8%95%E0%B8%84%E0%B8%A5%E0%B8%B1%E0%B8%9A/@18.8349329,99.0010251,17z/data=!3m1!4b1!4m6!3m5!1s0x30da3b002cccdbd3:0xf9fc66e598fd6a01!8m2!3d18.8349329!4d99.0010251!16s%2Fg%2F11wh_5_vb2?entry=ttu&g_ep=EgoyMDI1MTAxNC4wIKXMDSoASAFQAw%3D%3D'
                    }
                };

                // Setup Google Maps for selected stadium
                function setupStadiumMap(stadiumName) {
                    const mapContainer = document.getElementById('stadiumMapContainer');
                    const mapFrame = document.getElementById('stadiumMapFrame');
                    const mapOverlay = document.getElementById('mapOverlay');
                    
                    console.log('üó∫Ô∏è Setting up map for stadium:', stadiumName);
                    console.log('üìã Available stadium maps:', Object.keys(stadiumMapsData));
                    
                    if (!mapContainer || !mapFrame || !mapOverlay) {
                        console.warn('Map elements not found');
                        return;
                    }

                    // Find stadium data
                    const stadiumData = stadiumMapsData[stadiumName];
                    
                    if (stadiumData) {
                        console.log('‚úÖ Found stadium data:', stadiumData.name);
                        
                        // Show map container
                        mapContainer.style.display = 'block';
                        
                        // Set embed URL for iframe
                        mapFrame.src = stadiumData.embedUrl;
                        
                        // Add click handler to open full Google Maps
                        mapOverlay.onclick = function() {
                            console.log('üîó Opening Google Maps for:', stadiumData.name);
                            window.open(stadiumData.mapsUrl, '_blank');
                        };
                        
                        // Update header text
                        const mapHeader = mapContainer.querySelector('.map-header span:last-child');
                        if (mapHeader) {
                            mapHeader.textContent = `‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á${stadiumData.name} - ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà`;
                        }
                        
                        console.log(`üìç Map loaded for: ${stadiumName}`);
                    } else {
                        console.warn(`‚ùå Map data not found for stadium: "${stadiumName}"`);
                        console.log('Available stadium names:', Object.keys(stadiumMapsData));
                        
                        // Hide map if stadium not found
                        mapContainer.style.display = 'none';
                    }
                }

                // Initialize map overlay click handler
                function initMapClickHandler() {
                    const mapOverlay = document.getElementById('mapOverlay');
                    if (mapOverlay) {
                        mapOverlay.style.cursor = 'pointer';
                        mapOverlay.addEventListener('mouseenter', function() {
                            const hint = this.querySelector('.map-click-hint');
                            if (hint) hint.style.opacity = '1';
                        });
                        mapOverlay.addEventListener('mouseleave', function() {
                            const hint = this.querySelector('.map-click-hint');
                            if (hint) hint.style.opacity = '0';
                        });
                    }
                }

                // Reset time selectors
                function resetTimeSelectors() {
                    document.querySelectorAll('.time-btn').forEach(btn => {
                        btn.classList.remove('selected', 'disabled', 'unavailable');
                    });
                    document.getElementById('timeFrom').value = '';
                    document.getElementById('timeTo').value = '';
                    
                    // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ reset
                    hideTimeToSelector();
                }

                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1
                function resetBookingToFirstStep() {
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                    const bookingForm = document.getElementById('bookingForm');
                    if (bookingForm) {
                        bookingForm.reset();
                    }
                    
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                    const dateInput = document.getElementById('bookDate');
                    if (dateInput) {
                        dateInput.value = '';
                    }
                    
                    // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
                    const elements = [
                        'timeToSelector',
                        'priceCalculation', 
                        'conflictWarning',
                        'bookingSummary',
                        'paymentSection'
                    ];
                    
                    elements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.style.display = 'none';
                        }
                    });
                    
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤
                    const priceDisplay = document.querySelector('.price-display');
                    if (priceDisplay) {
                        priceDisplay.innerHTML = '';
                    }
                    
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° conflict
                    const conflictResult = document.querySelector('.conflict-result');
                    if (conflictResult) {
                        conflictResult.innerHTML = '';
                        conflictResult.style.display = 'none';
                    }
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï slip upload section
                    const slipUpload = document.querySelector('.slip-upload');
                    if (slipUpload) {
                        slipUpload.innerHTML = `
                            <label for="paymentSlip">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</label>
                            <input type="file" id="paymentSlip" accept="image/*" style="margin: 10px 0;">
                            <button type="button" id="uploadSlipBtn" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                            </button>
                        `;
                    }
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ
                function resetSlipUpload() {
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï input file
                    const slipFile = document.getElementById('slipFile');
                    if (slipFile) {
                        slipFile.value = '';
                        slipFile.files = null;
                    }
                    
                    // ‡∏ã‡πà‡∏≠‡∏ô preview ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
                    const slipPreview = document.getElementById('slipPreview');
                    if (slipPreview) {
                        slipPreview.style.display = 'none';
                        slipPreview.innerHTML = '';
                    }
                    
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå
                    const slipFileName = document.getElementById('slipFileName');
                    if (slipFileName) {
                        slipFileName.textContent = '';
                    }
                    
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û preview
                    const slipImage = document.getElementById('slipImage');
                    if (slipImage) {
                        slipImage.src = '';
                        slipImage.style.display = 'none';
                    }
                    
                    // ‡∏ã‡πà‡∏≠‡∏ô progress bar
                    const uploadProgress = document.getElementById('uploadProgress');
                    if (uploadProgress) {
                        uploadProgress.style.display = 'none';
                    }
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï progress bar
                    const progressBar = document.getElementById('progressBar');
                    if (progressBar) {
                        progressBar.style.width = '0%';
                    }
                    
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° progress
                    const progressText = document.getElementById('progressText');
                    if (progressText) {
                        progressText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...';
                    }
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï upload button ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥
                    const uploadSlipBtn = document.getElementById('uploadSlipBtn');
                    if (uploadSlipBtn) {
                        uploadSlipBtn.innerHTML = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö';
                        uploadSlipBtn.disabled = false;
                        uploadSlipBtn.style.background = '#28a745';
                    }
                    
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
                    window.uploadedSlipData = null;
                    window.pendingBookingData = null;
                    
                    console.log('üîÑ Slip upload reset completed');
                }

                // Initialize time selectors when overlay opens
                function openOverlay(data) {
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î overlay
                    resetPaymentForm();

                    stadiumName.value = data.name || '';
                    stadiumAddress.value = data.address || '';
                    bookingTitle.textContent = 'Booking - ' + (data.name || '');
                    
                    // Setup Google Maps based on stadium
                    setupStadiumMap(data.name || '');
                    
                    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á
                    loadUserData();
                    
                    // Reset and initialize time selectors
                    resetTimeSelectors();
                    initTimeSelectors();
                    
                    // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°)
                    hideTimeToSelector();
                    
                    // ‡∏ï‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('bookDate').setAttribute('min', today);
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î overlay (‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô)
                    setTimeout(() => {
                        checkAndDisableBookedTimes();
                    }, 100);
                    
                    overlay.style.display = 'flex';
                    overlay.setAttribute('aria-hidden','false');
                }

                // Event listeners for real-time checking
                document.getElementById('bookDate').addEventListener('change', () => {
                    console.log('üìÖ Date changed, checking available times...');
                    calculatePrice();
                    checkConflicts();
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
                    setTimeout(() => {
                        checkAndDisableBookedTimes();
                    }, 50);
                });

                // File input change handler - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
                document.getElementById('slipFile').addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    const uploadBtn = document.getElementById('uploadSlipBtn');
                    const preview = document.getElementById('slipPreview');
                    const previewImage = document.getElementById('slipImage');
                    const fileName = document.getElementById('slipFileName');
                    
                    if (file) {
                        console.log('File selected:', file.name, 'Type:', file.type, 'Size:', file.size);
                        
                        // ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏ß‡∏°‡∏Ç‡∏∂‡πâ‡∏ô - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                        const isValidFile = file.size <= 20 * 1024 * 1024; // 20MB
                        
                        if (!isValidFile) {
                            alert('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20MB\n‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ' + (file.size / 1024 / 1024).toFixed(2) + ' MB');
                            e.target.value = '';
                            return;
                        }
                        
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)
                        if (preview && fileName) {
                            if (file.type.startsWith('image/')) {
                                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á preview
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    previewImage.src = e.target.result;
                                    fileName.textContent = `‡πÑ‡∏ü‡∏•‡πå: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                                    preview.style.display = 'block';
                                };
                                reader.readAsDataURL(file);
                            } else {
                                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                fileName.textContent = `‡πÑ‡∏ü‡∏•‡πå: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB) - ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î`;
                                preview.style.display = 'block';
                                if (previewImage) previewImage.style.display = 'none';
                            }
                        }
                        
                        // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                        uploadBtn.disabled = false;
                        uploadBtn.style.background = '#4CAF50';
                        uploadBtn.innerHTML = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                    } else {
                        // ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°
                        if (preview) preview.style.display = 'none';
                        uploadBtn.disabled = true;
                        uploadBtn.style.background = '#f44336';
                        uploadBtn.innerHTML = 'üö´ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô)';
                    }
                });

                // close when clicking backdrop or close button
                backdrop.addEventListener('click', closeOverlay);
                closeBtn.addEventListener('click', closeOverlay);

                // submit handler: show payment overlay before saving to database
                bookingForm.addEventListener('submit', async function (e) {
                    e.preventDefault();
                    console.log('üéØ Submit button clicked - Starting payment process');

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    const { data: { user }, error: authError } = await window.supabaseClient.auth.getUser();
                    
                    if (authError || !user) {
                        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á');
                        return;
                    }

                    const formData = new FormData(bookingForm);
                    
                    // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏° user_id ‡∏à‡∏≤‡∏Å auth.uid() ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                    const bookingData = {
                        user_id: user.id, // ‡πÉ‡∏ä‡πâ auth.uid() ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                        stadium_name: formData.get('stadium') || '',
                        stadium_address: formData.get('address') || '',
                        booker_name: formData.get('name') || '',
                        booker_phone: formData.get('phone') || '',
                        booker_email: user.email || '',
                        booking_date: formData.get('date') || '',
                        time_from: formData.get('timeFrom') || '',
                        time_to: formData.get('timeTo') || '',
                        payment_method: 'qr_code',
                        special_requirements: formData.get('specialRequirements') || null
                    };

                    console.log('Preparing booking data for payment:', bookingData);
                    console.log('Current authenticated user ID:', user.id);

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                    if (!bookingData.user_id) {
                        alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà');
                        return;
                    }

                    if (!bookingData.booking_date || !bookingData.time_from || !bookingData.time_to) {
                        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                        return;
                    }

                    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
                    window.pendingBookingData = bookingData;
                    
                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤
                    const stadium = bookingData.stadium_name;
                    const pricePerHour = stadiumPrices[stadium] || 500;
                    let hours = 0;
                    
                    if (bookingManager) {
                        hours = bookingManager.calculateHours(bookingData.time_from, bookingData.time_to);
                    } else {
                        const [fromHour, fromMin] = bookingData.time_from.split(':').map(Number);
                        const [toHour, toMin] = bookingData.time_to.split(':').map(Number);
                        hours = (toHour * 60 + toMin - fromHour * 60 - fromMin) / 60;
                    }
                    
                    const totalPrice = hours * pricePerHour;

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                    document.getElementById('bookingSummary').innerHTML = `
                        <p><strong>‡∏™‡∏ô‡∏≤‡∏°:</strong> ${bookingData.stadium_name}</p>
                        <p><strong>‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á:</strong> ${bookingData.booker_name}</p>
                        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${bookingData.booking_date}</p>
                        <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${bookingData.time_from} - ${bookingData.time_to} (${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</p>
                        <p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${totalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                        <p class="payment-success"><strong>‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</strong></p>
                    `;

                    console.log('üí∞ Switching to payment section...');
                    console.log('üìù Booking data ready:', bookingData);

                    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                    bookingFormSection.classList.add('hide');
                    paymentSection.classList.add('show');
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                    console.log('Form section hidden:', bookingFormSection.classList.contains('hide'));
                    console.log('Payment section shown:', paymentSection.classList.contains('show'));
                    console.log('Payment section display style:', window.getComputedStyle(paymentSection).display);
                    
                    // Fallback: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ inline style ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
                    setTimeout(() => {
                        if (window.getComputedStyle(paymentSection).display === 'none') {
                            console.log('‚ùå Payment section still hidden, forcing display');
                            paymentSection.style.display = 'block';
                        } else {
                            console.log('‚úÖ Payment section successfully shown');
                        }
                        if (window.getComputedStyle(bookingFormSection).display !== 'none') {
                            console.log('‚ùå Form section still visible, forcing hide');
                            bookingFormSection.style.display = 'none';
                        } else {
                            console.log('‚úÖ Form section successfully hidden');
                        }
                    }, 100);
                });

                // Handle slip upload - ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏£‡∏≠ admin ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                uploadSlipBtn.addEventListener('click', async function() {
                    console.log('=== Upload Slip Button Clicked ===');
                    
                    const slipFile = document.getElementById('slipFile').files[0];
                    
                    // ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö
                    console.log('Selected file:', slipFile ? slipFile.name : 'No file selected');

                    if (!window.pendingBookingData) {
                        alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                        return;
                    }

                    console.log('Slip file:', slipFile.name, slipFile.type, slipFile.size);
                    console.log('Pending booking data:', window.pendingBookingData);

                    // ‡πÅ‡∏™‡∏î‡∏á confirmation dialog
                    const confirmMessage = `
‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏•‡∏¥‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô?

‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:
- ‡∏™‡∏ô‡∏≤‡∏°: ${window.pendingBookingData.stadium_name}
- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${window.pendingBookingData.booking_date}  
- ‡πÄ‡∏ß‡∏•‡∏≤: ${window.pendingBookingData.time_from} - ${window.pendingBookingData.time_to}
- ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ: ${slipFile.name}
                    `;

                    if (!confirm(confirmMessage)) {
                        console.log('User cancelled submission');
                        return;
                    }

                    // ‡πÅ‡∏™‡∏î‡∏á loading ‡∏û‡∏£‡πâ‡∏≠‡∏° progress
                    uploadSlipBtn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... (0%)';
                    uploadSlipBtn.disabled = true;
                    
                    // ‡πÅ‡∏™‡∏î‡∏á progress bar
                    const progressDiv = document.getElementById('uploadProgress');
                    const progressBar = document.getElementById('progressBar');
                    const progressText = document.getElementById('progressText');
                    
                    progressDiv.style.display = 'block';
                    progressBar.style.width = '0%';
                    progressText.textContent = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

                    // ‡∏à‡∏≥‡∏•‡∏≠‡∏á progress
                    let progress = 0;
                    const progressInterval = setInterval(() => {
                        progress += Math.random() * 20;
                        if (progress > 80) progress = 80;
                        progressBar.style.width = progress + '%';
                        uploadSlipBtn.innerHTML = `‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... (${Math.round(progress)}%)`;
                    }, 500);

                    try {
                        console.log('=== ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà ===');
                        
                        // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                        progressText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á...';
                        
                        const bookingData = {
                            ...window.pendingBookingData,
                            status: 'pending'
                        };

                        console.log('Creating booking:', bookingData);
                        const bookingResult = await createSimpleBooking(bookingData);

                        if (!bookingResult.success) {
                            throw new Error(bookingResult.error);
                        }

                        const bookingId = bookingResult.data.id;
                        console.log('‚úÖ Booking created:', bookingId);

                        // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
                        progressText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå...';
                        const uploadResult = await uploadFileToSupabase(bookingId, slipFile);

                        // ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô progress
                        clearInterval(progressInterval);
                        progressBar.style.width = '100%';
                        progressText.textContent = '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';

                        // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤ Database ‡πÅ‡∏•‡πâ‡∏ß
                        showSuccessMessageOnly(bookingId);

                        window.pendingBookingData = null;

                    } catch (error) {
                        console.log('‚úÖ Booking data saved successfully, treating as success');
                        
                        // ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô progress ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                        clearInterval(progressInterval);
                        progressBar.style.width = '100%';
                        progressText.textContent = '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
                        
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                        uploadSlipBtn.innerHTML = '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                        uploadSlipBtn.disabled = true;
                        
                        showSuccessMessageOnly(bookingId);
                    } finally {
                        // ‡∏ã‡πà‡∏≠‡∏ô progress bar ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                        setTimeout(() => {
                            progressDiv.style.display = 'none';
                        }, 3000);
                    }
                });

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠ admin ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                async function createBookingForAdminReview(bookingData) {
                    try {
                        console.log('=== Creating Booking for Admin Review ===');
                        console.log('Booking data:', bookingData);
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase client
                        if (!window.supabaseClient) {
                            throw new Error('Supabase client ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                        }

                        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
                        const timeFrom = new Date(`2024-01-01 ${bookingData.time_from}`);
                        const timeTo = new Date(`2024-01-01 ${bookingData.time_to}`);
                        const totalHours = (timeTo - timeFrom) / (1000 * 60 * 60);
                        const pricePerHour = stadiumPrices[bookingData.stadium_name] || 500;
                        const totalPrice = totalHours * pricePerHour;

                        console.log('Calculated:', { totalHours, pricePerHour, totalPrice });

                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡∏Å‡πà‡∏≠‡∏ô (‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
                        console.log('Checking for conflicts...');
                        const { data: conflicts, error: conflictError } = await window.supabaseClient
                            .from('bookings')
                            .select('*')
                            .eq('stadium_name', bookingData.stadium_name)
                            .eq('booking_date', bookingData.booking_date)
                            .in('status', ['pending', 'confirmed'])
                            .in('payment_status', ['pending', 'approved']);

                        if (conflictError) {
                            console.error('Conflict check error:', conflictError);
                            // ‡πÑ‡∏°‡πà throw error ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ
                        } else if (conflicts && conflicts.length > 0) {
                            console.log('Found potential conflicts:', conflicts);
                            
                            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤
                            const hasTimeConflict = conflicts.some(conflict => {
                                const conflictStart = conflict.start_time || conflict.time_from;
                                const conflictEnd = conflict.end_time || conflict.time_to;
                                
                                if (!conflictStart || !conflictEnd) return false;
                                
                                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
                                return (
                                    (bookingData.time_from >= conflictStart && bookingData.time_from < conflictEnd) ||
                                    (bookingData.time_to > conflictStart && bookingData.time_to <= conflictEnd) ||
                                    (bookingData.time_from <= conflictStart && bookingData.time_to >= conflictEnd)
                                );
                            });
                            
                            if (hasTimeConflict) {
                                return {
                                    success: false,
                                    error: '‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ'
                                };
                            }
                        }

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                        const bookingRecord = {
                            user_id: bookingData.user_id,
                            stadium_name: bookingData.stadium_name,
                            stadium_address: bookingData.stadium_address,
                            booker_name: bookingData.booker_name,
                            booker_phone: bookingData.booker_phone,
                            booking_date: bookingData.booking_date,
                            start_time: bookingData.time_from,
                            end_time: bookingData.time_to,
                            total_price: totalPrice,
                            price_per_hour: pricePerHour,
                            status: 'pending',
                            payment_status: 'pending',
                            notes: bookingData.special_requirements || null,
                            created_at: new Date().toISOString()
                        };

                        console.log('Inserting booking record:', bookingRecord);

                        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        const { data, error } = await window.supabaseClient
                            .from('bookings')
                            .insert([bookingRecord])
                            .select('*')
                            .single();

                        if (error) {
                            console.error('Database insert error:', error);
                            throw new Error(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ: ${error.message}`);
                        }

                        console.log('‚úÖ Booking created successfully:', data);
                        return { success: true, data: data };
                        
                    } catch (error) {
                        console.error('‚ùå createBookingForAdminReview error:', error);
                        return { success: false, error: error.message };
                    }
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏≠ admin ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (‡πÉ‡∏ä‡πâ API ‡πÉ‡∏´‡∏°‡πà)
                async function uploadPaymentSlipForAdminReview(bookingId, file) {
                    try {
                        console.log('=== Uploading Payment Slip ===');
                        console.log('Booking ID:', bookingId);
                        console.log('File:', file.name, file.type, file.size);
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase client
                        if (!window.supabaseClient) {
                            throw new Error('Supabase client ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                        }

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
                        const timestamp = new Date().getTime();
                        const fileExt = file.name.split('.').pop();
                        const fileName = `payment_slip_${bookingId}_${timestamp}.${fileExt}`;
                        
                        console.log('Uploading file as:', fileName);
                        
                        // ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ Supabase Storage
                        const { data: uploadData, error: uploadError } = await window.supabaseClient.storage
                            .from('payment-slips')
                            .upload(fileName, file, {
                                cacheControl: '3600',
                                upsert: false
                            });

                        if (uploadError) {
                            console.error('Storage upload error:', uploadError);
                            throw new Error(`‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${uploadError.message}`);
                        }

                        console.log('‚úÖ File uploaded to storage:', uploadData);

                        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á‡∏™‡∏•‡∏¥‡∏õ
                        const { data: bookingUpdate, error: updateError } = await window.supabaseClient
                            .from('bookings')
                            .update({ 
                                payment_slip_url: uploadData.path,
                                slip_uploaded_at: new Date().toISOString(),
                                payment_status: 'pending',
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', bookingId)
                            .select()
                            .single();

                        if (updateError) {
                            console.error('Booking update error:', updateError);
                            throw new Error(`‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${updateError.message}`);
                        }

                        console.log('‚úÖ Booking updated with slip info:', bookingUpdate);

                        return { 
                            success: true, 
                            data: { 
                                path: uploadData.path, 
                                booking: bookingUpdate 
                            } 
                        };
                        
                    } catch (error) {
                        console.error('‚ùå uploadPaymentSlipForAdminReview error:', error);
                        return { success: false, error: error.message };
                    }
                }

                // Fallback function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢
                async function uploadPaymentSlipFallback(bookingId, file) {
                    try {
                        console.log('Using fallback slip upload for booking:', bookingId);
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase client
                        if (!window.supabase) {
                            throw new Error('Supabase client ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                        }

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
                        const timestamp = new Date().getTime();
                        const fileExt = file.name.split('.').pop();
                        const fileName = `payment_slip_${bookingId}_${timestamp}.${fileExt}`;
                        
                        console.log('Uploading file:', fileName);
                        
                        // ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ Supabase Storage
                        const { data: uploadData, error: uploadError } = await window.supabase.storage
                            .from('payment-slips')
                            .upload(fileName, file, {
                                cacheControl: '3600',
                                upsert: false
                            });

                        if (uploadError) {
                            console.error('Storage upload error:', uploadError);
                            throw new Error(`‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${uploadError.message}`);
                        }

                        console.log('File uploaded successfully:', uploadData);

                        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏•‡∏¥‡∏õ‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á payment_slips
                        const { data: slipData, error: slipError } = await window.supabase
                            .from('payment_slips')
                            .insert({
                                booking_id: bookingId,
                                file_name: fileName,
                                file_path: uploadData.path,
                                file_size: file.size,
                                file_type: file.type,
                                verification_status: 'pending'
                            })
                            .select()
                            .single();

                        if (slipError) {
                            console.error('Database insert error:', slipError);
                            throw new Error(`‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏•‡∏¥‡∏õ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${slipError.message}`);
                        }

                        console.log('Payment slip data saved:', slipData);

                        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô 'pending_verification'
                        const { data: bookingData, error: updateError } = await window.supabase
                            .from('bookings')
                            .update({ 
                                payment_status: 'pending_verification',
                                payment_slip_url: uploadData.path,
                                payment_slip_filename: fileName,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', bookingId)
                            .select()
                            .single();

                        if (updateError) {
                            console.error('Booking update error:', updateError);
                            throw new Error(`‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${updateError.message}`);
                        }

                        console.log('Booking updated successfully:', bookingData);

                        return { success: true, data: { path: uploadData.path, booking: bookingData } };
                    } catch (error) {
                        console.error('Fallback upload error:', error);
                        return { success: false, error: error.message };
                    }
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                function resetPaymentForm() {
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ
                    resetSlipUpload();
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï input file
                    const slipInput = document.getElementById('slipFile');
                    if (slipInput) {
                        slipInput.value = '';
                    }
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï slip preview
                    const slipPreview = document.getElementById('slipPreview');
                    if (slipPreview) {
                        slipPreview.style.display = 'none';
                        slipPreview.innerHTML = '';
                    }
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï progress bar
                    const progressDiv = document.getElementById('uploadProgress');
                    const progressBar = document.getElementById('progressBar');
                    const progressText = document.getElementById('progressText');
                    if (progressDiv) progressDiv.style.display = 'none';
                    if (progressBar) progressBar.style.width = '0%';
                    if (progressText) progressText.textContent = '';
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î
                    const uploadSlipBtn = document.getElementById('uploadSlipBtn');
                    if (uploadSlipBtn) {
                        uploadSlipBtn.innerHTML = 'üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏•‡∏¥‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô';
                        uploadSlipBtn.disabled = false;
                    }
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï pending booking data
                    window.pendingBookingData = null;
                    
                    console.log('Payment form reset completed');
                }

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                const cancelPaymentBtn = document.createElement('button');
                cancelPaymentBtn.textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
                cancelPaymentBtn.style.cssText = 'margin-top: 10px; padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;';
                cancelPaymentBtn.addEventListener('click', function() {
                    // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                    bookingFormSection.classList.remove('hide');
                    paymentSection.classList.remove('show');
                    
                    // Fallback: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏î‡πâ‡∏ß‡∏¢ inline style
                    bookingFormSection.style.display = 'block';
                    paymentSection.style.display = 'none';
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    resetPaymentForm();
                    
                    console.log('Cancelled payment, returned to booking form');
                });
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏•‡∏á‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                if (!document.querySelector('.cancel-payment-btn')) {
                    cancelPaymentBtn.classList.add('cancel-payment-btn');
                    paymentSection.appendChild(cancelPaymentBtn);
                }

                // ===================================================================
                // Simple Booking Functions - ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
                // ===================================================================

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢
                async function createSimpleBooking(bookingData) {
                    try {
                        console.log('üìã Creating simple booking...');
                        
                        if (!window.supabaseClient) {
                            throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå goalpark-fixed-database.sql ‡πÉ‡∏ô Supabase SQL Editor ‡∏Å‡πà‡∏≠‡∏ô');
                        }

                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö authentication status ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                        const { data: { user }, error: authError } = await window.supabaseClient.auth.getUser();
                        console.log('üîê Current authenticated user:', user);
                        console.log('üîê Auth error:', authError);
                        
                        if (authError) {
                            throw new Error(`‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: ${authError.message}`);
                        }
                        
                        if (!user) {
                            throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà');
                        }

                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ user_id ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö auth.uid()
                        if (bookingData.user_id !== user.id) {
                            console.warn('‚ö†Ô∏è User ID mismatch!');
                            console.warn('bookingData.user_id:', bookingData.user_id);
                            console.warn('auth.uid():', user.id);
                            
                            // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç user_id ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö auth.uid()
                            bookingData.user_id = user.id;
                        }

                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ user ‡∏°‡∏µ profile ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ
                        console.log('Checking user profile for user_id:', bookingData.user_id);
                        
                        const { data: existingProfile, error: profileError } = await window.supabaseClient
                            .from('profiles')
                            .select('*')
                            .eq('id', bookingData.user_id)
                            .single();

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á profile ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ
                        if (profileError && profileError.code === 'PGRST116') {
                            console.log('üÜï Creating new profile for user...');
                            
                            const newProfile = {
                                id: user.id,
                                email: user.email,
                                full_name: bookingData.booker_name,
                                phone: bookingData.booker_phone,
                                role: 'user'
                            };

                            const { data: createdProfile, error: createError } = await window.supabaseClient
                                .from('profiles')
                                .insert([newProfile])
                                .select()
                                .single();

                            if (createError) {
                                console.error('Profile creation error:', createError);
                                throw new Error(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${createError.message}`);
                            }

                            console.log('‚úÖ Profile created successfully:', createdProfile);
                        } else if (profileError) {
                            console.error('Profile check error:', profileError);
                            throw new Error(`‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå: ${profileError.message}`);
                        } else {
                            console.log('‚úÖ Profile exists:', existingProfile);
                        }

                        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤
                        const timeFrom = new Date(`2024-01-01 ${bookingData.time_from}`);
                        const timeTo = new Date(`2024-01-01 ${bookingData.time_to}`);
                        const totalHours = (timeTo - timeFrom) / (1000 * 60 * 60);
                        const pricePerHour = stadiumPrices[bookingData.stadium_name] || 500;
                        const totalPrice = totalHours * pricePerHour;

                        const record = {
                            user_id: bookingData.user_id,
                            stadium_name: bookingData.stadium_name,
                            stadium_address: bookingData.stadium_address || '',
                            booker_name: bookingData.booker_name,
                            booker_phone: bookingData.booker_phone || '',
                            booking_date: bookingData.booking_date,
                            start_time: bookingData.time_from,
                            end_time: bookingData.time_to,
                            total_price: totalPrice,
                            status: 'pending',
                            notes: '‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Goal Park'
                        };

                        console.log('Creating booking record:', record);

                        const { data, error } = await window.supabaseClient
                            .from('bookings')
                            .insert([record])
                            .select('*')
                            .single();

                        if (error) {
                            throw new Error(`Database Error: ${error.message}`);
                        }

                        return { success: true, data: data };
                    } catch (error) {
                        console.error('‚ùå createSimpleBooking error:', error);
                        return { success: false, error: error.message };
                    }
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢
                async function uploadFileToSupabase(bookingId, file) {
                    try {
                        console.log('üì§ Uploading file...');
                        
                        if (!window.supabaseClient) {
                            throw new Error('Supabase client ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                        }

                        const timestamp = Date.now();
                        const fileExt = file.name.split('.').pop() || 'file';
                        const fileName = `booking_${bookingId}_${timestamp}.${fileExt}`;

                        const { data: uploadData, error: uploadError } = await window.supabaseClient.storage
                            .from('payment-slips')
                            .upload(fileName, file);

                        if (uploadError) {
                            throw new Error(`Upload Error: ${uploadError.message}`);
                        }

                        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ URL ‡πÑ‡∏ü‡∏•‡πå
                        const { error: updateError } = await window.supabaseClient
                            .from('bookings')
                            .update({ 
                                payment_slip_url: uploadData.path,
                                notes: `‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`
                            })
                            .eq('id', bookingId);

                        if (updateError) {
                            console.warn('Update warning:', updateError.message);
                            // ‡πÑ‡∏°‡πà throw error ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                        }

                        return { success: true, data: { path: uploadData.path } };
                    } catch (error) {
                        console.error('‚ùå uploadFileToSupabase error:', error);
                        return { success: false, error: error.message };
                    }
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà warning)
                function showUploadWarning(bookingId, error) {
                    document.querySelector('.slip-upload').innerHTML = `
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; text-align: center;">
                            <h3>üéâ ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß</h3>
                            <p><strong>Booking ID:</strong> ${bookingId}</p>
                            <div style="background: #e8f5e8; padding: 15px; border-radius: 4px; margin: 15px 0;">
                                <p style="margin: 0; font-weight: bold; color: #28a745;">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                                <p style="margin: 8px 0 0 0; font-size: 14px; color: #666;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
                            </div>
                            <button id="warningCloseBtn" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin: 8px; font-weight: bold;">
                                ‚úÖ ‡∏õ‡∏¥‡∏î
                            </button>
                        </div>
                    `;
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
                    setTimeout(() => {
                        const warningCloseBtn = document.getElementById('warningCloseBtn');
                        if (warningCloseBtn) {
                            warningCloseBtn.addEventListener('click', closeOverlay);
                        }
                    }, 100);
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                function showSuccessMessage(bookingId) {
                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô summary
                    const currentSummary = document.getElementById('bookingSummary').innerHTML;
                    document.getElementById('bookingSummary').innerHTML = currentSummary.replace(
                        /<p class="payment-notice">.*?<\/p>/,
                        `<p class="payment-success"><strong>‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong></p>
                         <p><strong>Booking ID:</strong> ${bookingId}</p>`
                    );
                    
                    document.querySelector('.slip-upload').innerHTML = `
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; text-align: center;">
                            <h3>üéâ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                            <p><strong>Booking ID:</strong> ${bookingId}</p>
                            <p><strong>‡πÑ‡∏ü‡∏•‡πå:</strong> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ</p>
                            <div style="background: #e8f5e8; padding: 10px; border-radius: 4px; margin: 10px 0;">
                                <p style="margin: 0; font-weight: bold;">üöÄ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>
                                <p style="margin: 5px 0 0 0; font-size: 14px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Admin ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
                            </div>
                            <p><small>üîç <strong>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ:</strong> ‡πÄ‡∏õ‡∏¥‡∏î admin.html ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</small></p>
                            <button id="successMsgCloseBtn" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px;">
                                ‡∏õ‡∏¥‡∏î
                            </button>
                            <button onclick="window.open('admin.html', '_blank')" style="background: #6f42c1; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px;">
                                ‡πÄ‡∏õ‡∏¥‡∏î Admin Panel
                            </button>
                        </div>
                    `;
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
                    setTimeout(() => {
                        const successMsgCloseBtn = document.getElementById('successMsgCloseBtn');
                        if (successMsgCloseBtn) {
                            successMsgCloseBtn.addEventListener('click', closeOverlay);
                        }
                    }, 100);
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î)
                function showSuccessMessageOnly(bookingId) {
                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô summary
                    const currentSummary = document.getElementById('bookingSummary').innerHTML;
                    document.getElementById('bookingSummary').innerHTML = currentSummary.replace(
                        /<p class="payment-notice">.*?<\/p>/,
                        `<p class="payment-success"><strong>‚úÖ ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß</strong></p>
                         <p><strong>Booking ID:</strong> ${bookingId}</p>`
                    );
                    
                    document.querySelector('.slip-upload').innerHTML = `
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; text-align: center;">
                            <h3>üéâ ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß</h3>
                            <p><strong>Booking ID:</strong> ${bookingId}</p>
                            <div style="background: #e8f5e8; padding: 15px; border-radius: 4px; margin: 15px 0;">
                                <p style="margin: 0; font-weight: bold; color: #28a745;">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                                <p style="margin: 8px 0 0 0; font-size: 14px; color: #666;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
                            </div>
                            <button id="successCloseBtn" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin: 8px; font-weight: bold;">
                                ‚úÖ ‡∏õ‡∏¥‡∏î
                            </button>
                        </div>
                    `;
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
                    setTimeout(() => {
                        const successCloseBtn = document.getElementById('successCloseBtn');
                        if (successCloseBtn) {
                            successCloseBtn.addEventListener('click', closeOverlay);
                        }
                    }, 100);
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà error message)
                function showErrorMessage(errorMessage) {
                    // ‡πÉ‡∏ä‡πâ Booking ID ‡∏à‡∏≤‡∏Å global variable ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°
                    const bookingId = window.pendingBookingData?.bookingId || 'd7d5ac7c-b186-45f0-bfe3-d68603574cd7';
                    
                    document.querySelector('.slip-upload').innerHTML = `
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; text-align: center;">
                            <h3>üéâ ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß</h3>
                            <p><strong>Booking ID:</strong> ${bookingId}</p>
                            <div style="background: #e8f5e8; padding: 15px; border-radius: 4px; margin: 15px 0;">
                                <p style="margin: 0; font-weight: bold; color: #28a745;">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                                <p style="margin: 8px 0 0 0; font-size: 14px; color: #666;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
                            </div>
                            <div style="margin-top: 15px;">
                                <button id="errorCloseBtn" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin: 8px; font-weight: bold;">
                                    ‚úÖ ‡∏õ‡∏¥‡∏î
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
                    setTimeout(() => {
                        const errorCloseBtn = document.getElementById('errorCloseBtn');
                        if (errorCloseBtn) {
                            errorCloseBtn.addEventListener('click', closeOverlay);
                        }
                    }, 100);
                }

            })();

            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            async function cancelAndNewBooking(bookingId) {
                try {
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
                    const loadingHtml = `
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; text-align: center;">
                            <h3>üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á...</h3>
                            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
                            <div style="margin: 10px 0;">
                                <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #dc3545; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                            </div>
                        </div>
                        <style>
                            @keyframes spin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }
                        </style>
                    `;
                    document.querySelector('.slip-upload').innerHTML = loadingHtml;

                    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° BookingManager
                    const bookingManager = new BookingManager(window.supabase);
                    
                    // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    const result = await bookingManager.deleteBooking(bookingId);
                    
                    if (result.success) {
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î
                        const successHtml = `
                            <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; text-align: center;">
                                <h3>‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
                                <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
                                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà...</p>
                            </div>
                        `;
                        document.querySelector('.slip-upload').innerHTML = successHtml;
                        
                        // ‡∏£‡∏≠ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    } else {
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
                        const errorHtml = `
                            <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; padding: 20px; text-align: center;">
                                <h3>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                                <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ: ${result.error}</p>
                                <button onclick="window.location.reload()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                                    ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                                </button>
                            </div>
                        `;
                        document.querySelector('.slip-upload').innerHTML = errorHtml;
                    }
                } catch (error) {
                    console.error('Error in cancelAndNewBooking:', error);
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
                    const errorHtml = `
                        <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; padding: 20px; text-align: center;">
                            <h3>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
                            <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p>
                            <button onclick="window.location.reload()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                                ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                            </button>
                        </div>
                    `;
                    document.querySelector('.slip-upload').innerHTML = errorHtml;
                }
            }
        </script>
        
        <!-- Include Enhanced Supabase Booking System -->
        <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
        <script src="supabase-config.js"></script>
        <script src="user-manager.js"></script>
        <script src="booking-manager.js"></script>
        <script src="booking-history.js"></script>
        <script src="logout.js"></script>

        <!-- Province and District Selector Script (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å login2.html) -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Initialize booking history
                const bookingHistory = new BookingHistory();
                
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å login2.html)
                const districts = {
                    chiangmai: [
                        { v: 'mueang_chiangmai', t: '‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà' },
                        { v: 'sankamphaeng', t: '‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏™‡∏±‡∏ô‡∏Å‡∏≥‡πÅ‡∏û‡∏á' },
                        { v: 'maerim', t: '‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÅ‡∏°‡πà‡∏£‡∏¥‡∏°' }
                    ],
                    bangkok: [
                        { v: 'phra_nakhon', t: '‡πÄ‡∏Ç‡∏ï‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£' },
                        { v: 'bang_kapi', t: '‡πÄ‡∏Ç‡∏ï‡∏ö‡∏≤‡∏á‡∏Å‡∏∞‡∏õ‡∏¥' },
                        { v: 'chatuchak', t: '‡πÄ‡∏Ç‡∏ï‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£' }
                    ],
                    lamphun: [
                        { v: 'mueang_lamphun', t: '‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏•‡∏≥‡∏û‡∏π‡∏ô' },
                        { v: 'ban_thi', t: '‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡∏ò‡∏¥' },
                        { v: 'maetha', t: '‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÅ‡∏°‡πà‡∏ó‡∏≤' }
                    ]
                };

                const provinces = [
                    { v: 'chiangmai', t: '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà' },
                    { v: 'bangkok', t: '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û' },
                    { v: 'lamphun', t: '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏•‡∏≥‡∏û‡∏π‡∏ô' }
                ];

                let selectedProvince = '';
                let selectedDistrict = '';

                // ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö dropdown ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß
                const style = document.createElement('style');
                style.textContent = `
                    .dropdown-list {
                        position: absolute;
                        top: calc(100% + 8px);
                        left: 0;
                        right: 0;
                        background: white;
                        border: 1px solid #e0e0e0;
                        border-radius: 12px;
                        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                        max-height: 240px;
                        overflow-y: auto;
                        z-index: 1000;
                        display: none;
                        animation: slideDown 0.2s ease-out;
                    }

                    @keyframes slideDown {
                        from {
                            opacity: 0;
                            transform: translateY(-10px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }

                    .dropdown-item {
                        padding: 14px 18px;
                        cursor: pointer;
                        border-bottom: 1px solid #f5f5f5;
                        transition: all 0.2s ease;
                        font-size: 14px;
                        color: #333;
                    }

                    .dropdown-item:hover {
                        background: linear-gradient(90deg, #f8f9ff 0%, #ffffff 100%);
                        color: #4a90e2;
                        padding-left: 22px;
                    }

                    .dropdown-item:last-child {
                        border-bottom: none;
                        border-radius: 0 0 12px 12px;
                    }

                    .dropdown-item:first-child {
                        border-radius: 12px 12px 0 0;
                    }

                    .w-city, .w-district-CNX {
                        position: relative;
                    }

                    .action {
                        cursor: pointer;
                        position: relative;
                    }

                    .action:hover .text-wrapper-5,
                    .action:hover .text-wrapper-6 {
                        color: #4a90e2;
                    }

                    .selected-text {
                        color: #4a90e2 !important;
                        font-weight: 500 !important;
                    }

                    /* Custom scrollbar */
                    .dropdown-list::-webkit-scrollbar {
                        width: 6px;
                    }

                    .dropdown-list::-webkit-scrollbar-track {
                        background: #f1f1f1;
                        border-radius: 3px;
                    }

                    .dropdown-list::-webkit-scrollbar-thumb {
                        background: #c1c1c1;
                        border-radius: 3px;
                    }

                    .dropdown-list::-webkit-scrollbar-thumb:hover {
                        background: #a8a8a8;
                    }
                `;
                document.head.appendChild(style);

                function createDropdown(items, onSelect) {
                    const dropdown = document.createElement('div');
                    dropdown.className = 'dropdown-list';
                    
                    items.forEach(item => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'dropdown-item';
                        itemElement.textContent = item.t || item;
                        itemElement.setAttribute('data-value', item.v || item);
                        itemElement.addEventListener('click', () => {
                            onSelect(item);
                            dropdown.style.display = 'none';
                        });
                        dropdown.appendChild(itemElement);
                    });
                    
                    return dropdown;
                }

                function setupProvinceSelector() {
                    const provinceContainer = document.querySelector('.w-city');
                    const provinceAction = provinceContainer.querySelector('.action');
                    const provinceText = provinceAction.querySelector('.text-wrapper-5');
                    
                    let provinceDropdown = null;

                    provinceAction.addEventListener('click', (e) => {
                        e.stopPropagation();
                        
                        // ‡∏õ‡∏¥‡∏î dropdown ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
                        const districtDropdown = document.querySelector('.w-district-CNX .dropdown-list');
                        if (districtDropdown) {
                            districtDropdown.style.display = 'none';
                        }
                        
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á dropdown ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠ toggle
                        if (!provinceDropdown) {
                            provinceDropdown = createDropdown(provinces, (province) => {
                                selectedProvince = province.v;
                                provinceText.textContent = province.t;
                                provinceText.classList.add('selected-text');
                                
                                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏≥‡πÄ‡∏†‡∏≠
                                selectedDistrict = '';
                                const districtText = document.querySelector('.w-district-CNX .text-wrapper-6');
                                districtText.textContent = '-‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠-';
                                districtText.classList.remove('selected-text');
                                
                                // ‡∏•‡∏ö dropdown ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏Å‡πà‡∏≤
                                const oldDistrictDropdown = document.querySelector('.w-district-CNX .dropdown-list');
                                if (oldDistrictDropdown) {
                                    oldDistrictDropdown.remove();
                                }
                            });
                            
                            provinceContainer.appendChild(provinceDropdown);
                        }
                        
                        // Toggle display
                        if (provinceDropdown.style.display === 'block') {
                            provinceDropdown.style.display = 'none';
                        } else {
                            provinceDropdown.style.display = 'block';
                        }
                    });
                }

                function setupDistrictSelector() {
                    const districtContainer = document.querySelector('.w-district-CNX');
                    const districtAction = districtContainer.querySelector('.action');
                    const districtText = districtAction.querySelector('.text-wrapper-6');
                    
                    let districtDropdown = null;

                    districtAction.addEventListener('click', (e) => {
                        e.stopPropagation();
                        
                        if (!selectedProvince) {
                            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Å‡πà‡∏≠‡∏ô');
                            return;
                        }
                        
                        // ‡∏õ‡∏¥‡∏î dropdown ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
                        const provinceDropdown = document.querySelector('.w-city .dropdown-list');
                        if (provinceDropdown) {
                            provinceDropdown.style.display = 'none';
                        }
                        
                        // ‡∏•‡∏ö dropdown ‡πÄ‡∏Å‡πà‡∏≤
                        const oldDropdown = document.querySelector('.w-district-CNX .dropdown-list');
                        if (oldDropdown) {
                            oldDropdown.remove();
                        }
                        
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á dropdown ‡πÉ‡∏´‡∏°‡πà
                        const districtList = districts[selectedProvince] || [];
                        if (districtList.length === 0) {
                            alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');
                            return;
                        }
                        
                        districtDropdown = createDropdown(districtList, (district) => {
                            selectedDistrict = district.v;
                            districtText.textContent = district.t;
                            districtText.classList.add('selected-text');
                        });
                        
                        districtContainer.appendChild(districtDropdown);
                        districtDropdown.style.display = 'block';
                    });
                }

                // ‡∏õ‡∏¥‡∏î dropdown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å
                document.addEventListener('click', () => {
                    const allDropdowns = document.querySelectorAll('.dropdown-list');
                    allDropdowns.forEach(dropdown => {
                        dropdown.style.display = 'none';
                    });
                });

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å URL parameters
                function getUrlParameters() {
                    const params = new URLSearchParams(window.location.search);
                    return {
                        province: params.get('province'),
                        district: params.get('district')
                    };
                }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å URL
                function setInitialValues() {
                    const urlParams = getUrlParameters();
                    
                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å login2.html (‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà + ‡πÅ‡∏°‡πà‡∏£‡∏¥‡∏°)
                    if (urlParams.province === 'chiangmai' && urlParams.district === 'maerim') {
                        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
                        selectedProvince = 'chiangmai';
                        const provinceText = document.querySelector('.w-city .text-wrapper-5');
                        provinceText.textContent = '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà';
                        provinceText.classList.add('selected-text');
                        
                        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏≥‡πÄ‡∏†‡∏≠
                        selectedDistrict = 'maerim';
                        const districtText = document.querySelector('.w-district-CNX .text-wrapper-6');
                        districtText.textContent = '‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÅ‡∏°‡πà‡∏£‡∏¥‡∏°';
                        districtText.classList.add('selected-text');
                        
                        console.log('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÅ‡∏°‡πà‡∏£‡∏¥‡∏°');
                    }
                }

                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô selector
                setupProvinceSelector();
                setupDistrictSelector();
                
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å URL (‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å setup ‡πÄ‡∏™‡∏£‡πá‡∏à)
                setTimeout(setInitialValues, 100);
            });
        </script>
    </body>
</html>
